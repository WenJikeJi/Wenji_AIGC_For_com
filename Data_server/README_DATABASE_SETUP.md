# Wenji 项目数据库设置指南

## 数据库初始化步骤

### 前提条件
- 已安装Node.js
- 已安装MySQL数据库服务
- 已知MySQL数据库的有效用户名和密码

### 数据库连接测试

我已经为您创建了两个工具来帮助测试和配置数据库连接：

#### 1. 交互式连接测试工具

这个工具允许您交互式地输入数据库连接参数并测试连接是否成功。

```bash
# 在Data_server目录下运行
node db_connection_tester.js
```

使用步骤：
1. 运行上述命令
2. 根据提示输入MySQL连接信息（主机名、端口、用户名、密码、数据库名）
3. 工具会尝试连接到MySQL并显示连接结果
4. 如果连接成功，您可以选择将这些参数保存到.env文件

#### 2. 简单连接测试脚本

```bash
# 在Data_server目录下运行
node test_db_connection.js
```

这个脚本会使用.env文件中已配置的参数测试数据库连接。

### 数据库初始化

一旦数据库连接参数配置正确，您可以运行以下命令来初始化数据库：

```bash
# 在Data_server目录下运行
node init_databases.js
```

这个脚本会：
1. 创建必要的数据库表（用户表、操作日志表、验证码表等）
2. 插入初始数据（如超级管理员账户）
3. 配置系统加密参数

## 常见问题与解决方案

### 1. 连接被拒绝 (ER_ACCESS_DENIED_ERROR)

- 检查用户名和密码是否正确
- 确保MySQL用户允许从localhost连接
- 确认MySQL服务正在运行

### 2. 连接超时 (ECONNREFUSED)

- 确认MySQL服务正在运行
- 检查主机名和端口是否正确
- 验证防火墙设置是否允许连接

### 3. 数据库不存在

不用担心，初始化脚本会自动创建所需的数据库。

## 已完成的工作

1. 更新了 `init_databases.js` 脚本，使其从.env文件读取数据库连接参数
2. 创建了 `test_db_connection.js` 用于快速测试数据库连接
3. 创建了 `db_connection_tester.js` 交互式连接测试工具
4. 修改了 `.env` 文件以支持数据库连接配置

## 下一步操作

1. 使用交互式连接测试工具 `node db_connection_tester.js` 测试并配置数据库连接
2. 成功连接后，运行 `node init_databases.js` 初始化数据库
3. 完成后，可以继续前端和后端的集成测试